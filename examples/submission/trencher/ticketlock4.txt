# Ticket spin lock from linux kernel (32 bit x86)
# http://www.cl.cam.ac.uk/~pes20/weakmemory/ecoop10.pdf
# 0 - y
# 1 - x
# memory_size 10

thread t0
initial q0
transition q0 q1 lock
transition q1 q21 read tkt 0
transition q21	q2_0	check	< tkt 10
transition q2_0	q2	local nextTicket + tkt 1
transition q21	q22	check	>= tkt 10
transition q22	q23	local	nextTicket	0
transition q2 q3 write nextTicket 0
transition q3 q4 unlock
transition q4 q5 read rx 1
transition q5 q7 check == rx tkt
transition q7 q8 write nextTicket  1
transition q8 q0 noop
end


thread t1
initial q0
transition q0 q1 lock
transition q1 q21 read tkt 0
transition q21	q2_0	check	< tkt 10
transition q2_0	q2	local nextTicket + tkt 1
transition q21	q22	check	>= tkt 10
transition q22	q23	local	nextTicket	0
transition q2 q3 write nextTicket 0
transition q3 q4 unlock
transition q4 q5 read rx 1
transition q5 q7 check == rx tkt
transition q7 q8 write nextTicket  1
transition q8 q0 noop
end


thread t2
initial q0
transition q0 q1 lock
transition q1 q21 read tkt 0
transition q21	q2_0	check	< tkt 10
transition q2_0	q2	local nextTicket + tkt 1
transition q21	q22	check	>= tkt 10
transition q22	q23	local	nextTicket	0
transition q2 q3 write nextTicket 0
transition q3 q4 unlock
transition q4 q5 read rx 1
transition q5 q7 check == rx tkt
transition q7 q8 write nextTicket  1
transition q8 q0 noop
end


thread t3
initial q0
transition q0 q1 lock
transition q1 q21 read tkt 0
transition q21	q2_0	check	< tkt 10
transition q2_0	q2	local nextTicket + tkt 1
transition q21	q22	check	>= tkt 10
transition q22	q23	local	nextTicket	0
transition q2 q3 write nextTicket 0
transition q3 q4 unlock
transition q4 q5 read rx 1
transition q5 q7 check == rx tkt
transition q7 q8 write nextTicket  1
transition q8 q0 noop
end
